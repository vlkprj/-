

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í–ê–õ–ö–ò ‚Ä¢ –ì—Ä–∞—Ñ—ñ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --c-yellow: #fbbf24; --c-red: #d9463b; --c-dark: #060606; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--c-dark); color: #ffffff; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
        .sticky-header { position: sticky; top: 0; left: 0; width: 100%; background: rgba(6, 6, 6, 0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); z-index: 100; padding: 15px 20px; box-sizing: border-box; border-bottom: 1px solid rgba(255,255,255,0.08); box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .branding { display: flex; align-items: center; gap: 8px; }
        .logo-img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: #ffffff; border: 1px solid #eee; padding: 2px; box-sizing: border-box; }
        .app-title { font-size: 20px; font-weight: 900; letter-spacing: 0.5px; margin: 0; display: flex; align-items: center; gap: 6px; }
        .app-title svg { fill: var(--c-yellow); width: 22px; height: 22px; margin-top: -2px; }
        .date-badge { background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 12px; font-weight: 800; color: var(--c-yellow); font-size: 13px; text-transform: uppercase; }
        .dashboard { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 5px; }
        .status-box { display: flex; flex-direction: column; gap: 8px; justify-content: flex-end; }
        .status-label { font-size: 12px; color: #888; font-weight: 800; text-transform: uppercase; display: flex; align-items: center; letter-spacing: 0.5px; margin-bottom: 2px; }
        .status-value { display: flex; align-items: center; gap: 6px; font-size: 18px; font-weight: 800; line-height: 1; margin-bottom: 4px; }
        .live-dot { display: inline-block; width: 8px; height: 8px; background-color: var(--c-red); border-radius: 50%; margin-right: 6px; animation: blinkFast 1.5s infinite; }
        @keyframes blinkFast { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
        .timer-box { text-align: right; }
        .timer-label { font-size: 12px; color: #888; font-weight: 700; text-transform: uppercase; margin-bottom: 2px; }
        .timer-time { font-size: 34px; font-weight: 900; line-height: 1; font-variant-numeric: tabular-nums; letter-spacing: -1px; }
        .timer-time.off { color: var(--c-red); text-shadow: 0 0 15px rgba(217, 70, 59, 0.4); }
        .timer-time.on { color: var(--c-yellow); text-shadow: 0 0 15px rgba(251, 191, 36, 0.4); }
        #timelineContainer { padding: 20px; display: flex; flex-direction: column; gap: 0; min-height: 60vh; position: relative; }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.05); background: rgba(255,255,255,0.02); } 50% { box-shadow: 0 0 20px 0 rgba(255,255,255,0.08); background: rgba(255,255,255,0.06); } 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); background: rgba(255,255,255,0.02); } }
        @keyframes pulseGlowRed { 0% { box-shadow: 0 0 0 0 rgba(217,70,59,0.1); background: rgba(217,70,59,0.04); } 50% { box-shadow: 0 0 20px 0 rgba(217,70,59,0.15); background: rgba(217,70,59,0.08); } 100% { box-shadow: 0 0 0 0 rgba(217,70,59,0); background: rgba(217,70,59,0.04); } }
        @keyframes breath { 0% { transform: scale(1); opacity: 0.7; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 0.7; } }
        .tl-item { display: flex; flex-direction: column; z-index: 2; position: relative; padding: 10px 0; transition: 0.3s ease; border-radius: 16px; margin-bottom: -5px; }
        .tl-item.active-now { animation: pulseGlow 2.5s infinite; padding: 15px 10px; margin: 5px -10px; border: 1px solid rgba(255,255,255,0.05); overflow: visible; }
        .tl-item.active-now.emergency-active { animation: pulseGlowRed 2.5s infinite; border-color: rgba(217,70,59,0.15); }
        .tl-item.past-interval { opacity: 0.35; filter: grayscale(0.8); transition: all 0.2s ease; cursor: pointer; }
        .tl-item.past-interval:active { opacity: 1; filter: none; }
        .tl-head { display: flex; align-items: center; min-height: 40px; position: relative; z-index: 2; padding-right: 65px; }
        .time-col { width: 70px; text-align: right; padding-right: 15px; font-weight: 800; font-size: 20px; flex-shrink: 0; line-height: 1; margin: 0; letter-spacing: -0.5px; }
        .time-col.off { color: var(--c-red); }
        .time-col.on { color: var(--c-yellow); text-shadow: 0 0 10px rgba(251, 191, 36, 0.4); }
        .time-col.emergency { color: var(--c-red); }
        .icon-node { display: flex; flex-direction: column; align-items: center; width: 40px; flex-shrink: 0; }
        .icon-circle { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: #111; border: 1px solid #222; z-index: 3; position: relative; }
        .icon-house { width: 22px; height: 22px; }
        .on .icon-house { fill: var(--c-yellow); filter: drop-shadow(0 0 5px var(--c-yellow)); }
        .off .icon-house, .emergency .icon-house { fill: #555; }
        .badge-col { padding-left: 15px; flex-grow: 1; display: flex; align-items: center; }
        .badge { display: flex; align-items: center; justify-content: center; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 800; letter-spacing: 0.5px; width: max-content; line-height: 1; text-transform: uppercase; gap: 6px; }
        .badge.off { background: #1a1a1c; border: 1px solid #333; color: #a1a1aa; }
        .badge.on { background: rgba(251, 191, 36, 0.1); color: var(--c-yellow); border: 1px solid var(--c-yellow); }
        .badge.emergency { background: rgba(217,70,59,0.15); color: var(--c-red); border: 1px solid var(--c-red); }
        .badge-row { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; }
        .badge-modifier { font-size: 12px; font-weight: 800; text-transform: uppercase; }
        .badge-modifier.rescued { color: var(--c-yellow); }
        .badge-modifier.emergency { color: var(--c-red); }
        .now-badge { position: absolute; top: -4px; right: 0px; background: #fff; color: #000; padding: 2px 6px; border-radius: 5px; font-size: 8px; font-weight: 900; letter-spacing: 0.5px; box-shadow: 0 0 10px rgba(255,255,255,0.4); animation: pulseBadge 2s infinite; z-index: 10; }
        .emergency-active .now-badge { background: var(--c-red); color: #fff; box-shadow: 0 0 10px rgba(217,70,59,0.5); }
        @keyframes pulseBadge { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .tl-body { display: flex; align-items: stretch; min-height: 50px; position: relative; z-index: 1; }
        .line-node { display: flex; flex-direction: column; align-items: center; justify-content: space-evenly; width: 40px; flex-shrink: 0; padding: 10px 0; margin: 0; }
        .tl-dot-micro { width: 6px; height: 6px; border-radius: 50%; opacity: 0.9; flex-shrink: 0; margin: 3px 0; }
        .tl-dot-micro.on { background: var(--c-yellow); box-shadow: 0 0 4px rgba(251, 191, 36, 0.5); }
        .tl-dot-micro.off { background: #555; }
        .tl-dot-micro.emergency { background: var(--c-red); box-shadow: 0 0 4px rgba(217,70,59,0.5); }
        .active-now .tl-dot-micro { animation: breath 2s infinite ease-in-out; }
        .interval-col { padding-left: 15px; flex-grow: 1; display: flex; align-items: center; }
        .interval { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 700; line-height: 1; }
        .interval-icon { display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; flex-shrink: 0; }
        .interval-icon svg { width: 100%; height: 100%; display: block; }
        .interval.off { color: var(--c-red); }
        .interval.on { color: var(--c-yellow); }
        .interval.emergency { color: var(--c-red); }
        .waiting-block { text-align: center; padding: 30px 20px; color: #888; font-weight: 700; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .spinner-dots::after { content: ''; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0% { content: ''; } 25% { content: '.'; } 50% { content: '..'; } 75% { content: '...'; } 100% { content: ''; } }
        .fade-dots { display: flex; flex-direction: column; align-items: center; gap: 6px; margin-top: 15px; opacity: 0.5; }
        .fade-dot { width: 6px; height: 6px; border-radius: 50%; background: #555; }
        .fade-dot:nth-child(1) { opacity: 0.8; }
        .fade-dot:nth-child(2) { opacity: 0.5; }
        .fade-dot:nth-child(3) { opacity: 0.2; }
        .app-footer { margin-top: 10px; padding: 25px 20px 40px; border-top: 1px solid rgba(255,255,255,0.05); text-align: center; }
        .footer-links { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .f-link { color: #aaa; text-decoration: none; font-size: 13px; font-weight: 700; background: rgba(255,255,255,0.06); padding: 11px 18px; border-radius: 14px; transition: 0.2s; display: flex; align-items: center; gap: 7px; border: 1px solid rgba(255,255,255,0.07); }
        .f-link:active { background: rgba(255,255,255,0.12); color: #fff; }
        .f-link svg { flex-shrink: 0; }
        .disclaimer-box { display: flex; align-items: flex-start; text-align: left; gap: 8px; font-size: 13px; color: #777; line-height: 1.4; font-weight: 500; background: rgba(255,255,255,0.03); padding: 12px 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .source-text { font-size: 12px; color: #666; font-weight: 500; }
        .loader { text-align: center; color: #888; margin-top: 50px; font-weight: bold; }
                 @keyframes sonyaBreath {
            0% { transform: translateX(-50%) scale(1); opacity: 0.95; }
            50% { transform: translateX(-50%) scale(1.05); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 0.95; }
        }
        .mascot-header {
            position: absolute;
            left: 50%;
            bottom: -15px;
            height: 85px;
            width: auto;
            object-fit: contain;
            transform-origin: bottom center;
            animation: sonyaBreath 3s infinite ease-in-out;
            filter: drop-shadow(0 0 15px rgba(217, 70, 59, 0.3));
            pointer-events: none;
            z-index: 10;
        }



    </style>
</head>
<body ontouchstart="">

<div id="loader" class="loader">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...‚ö°</div>

<div id="toastInside" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; background: rgba(10, 10, 12, 0.85); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.05); border-left: 3px solid var(--c-yellow); border-radius: 14px; padding: 16px 20px; width: 90%; max-width: 400px; box-shadow: 0 15px 35px rgba(0,0,0,0.6); align-items: center; gap: 12px;">
    <div style="font-size: 22px; line-height: 1; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2));">ü§´</div>
    <div id="toastText" style="color: #f4f4f5; font-size: 14px; font-weight: 700; flex-grow: 1; line-height: 1.4; letter-spacing: 0.3px;"></div>
    <div onclick="document.getElementById('toastInside').style.display='none'" style="color: #666; font-size: 26px; cursor: pointer; line-height: 1; padding-bottom: 2px; transition: color 0.2s;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#666'">&times;</div>
</div>



<div id="app" style="display: none;">
    <div class="sticky-header">
        <div class="header-top">
            <div class="branding">
                <img src="./logo.png" alt="" class="logo-img" onerror="this.style.display='none'">
                <h1 class="app-title">
                    <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                    –í–ê–õ–ö–ò
                </h1>
            </div>
            <div class="date-badge" id="dateDisplay">–û–ß–Ü–ö–£–Ñ–ú–û</div>
        </div>
              <div class="dashboard" style="position: relative;">
            <img id="sonyaMascot" src="./sonya-off.PNG?v=1" alt="–°–æ–Ω—è" class="mascot-header" style="display: none;">


            <div class="status-box">
                <div class="status-label"><span class="live-dot"></span>–°—Ç–∞—Ç—É—Å</div>
                <div class="status-value" id="timerStatus">...</div>
            </div>
            <div class="timer-box">
                <div class="timer-label" id="timerLabel">–û–Ω–æ–≤–ª–µ–Ω–Ω—è...</div>
                <div class="timer-time" id="timerDisplay">--:--:--</div>
            </div>
        </div>
    </div>

        <div class="disclaimer-box">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 1px;"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            <div>–§–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å —ñ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∞–Ω—É –µ–Ω–µ—Ä–≥–æ—Å–∏—Å—Ç–µ–º–∏.</div>
        </div>

    
    <div id="timelineContainer"></div>

    <div class="app-footer">
        <div class="footer-links">
            <a href="https://t.me/share/url?url=t.me/valkyelectrifybot/electric&text=üí°%20–ê–∫—Ç—É–∞–ª—å–Ω–∏–π%20–≥—Ä–∞—Ñ—ñ–∫%20–≤—ñ–¥–∫–ª—é—á–µ–Ω—å%20—Å–≤—ñ—Ç–ª–∞%20—É%20–í–∞–ª–∫–∞—Ö" class="f-link" target="_blank">
                <svg viewBox="0 0 24 24" width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
                –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è
            </a>
            <a href="https://t.me/valkychat" class="f-link" target="_blank">
                <svg viewBox="0 0 24 24" width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                –ß–∞—Ç
            </a>
            <a href="https://t.me/valkybazar" class="f-link" target="_blank">
                <svg viewBox="0 0 24 24" width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                –ë–∞–∑–∞—Ä—á–∏–∫
            </a>
        </div>
        
        <div class="source-text"><b>–î–∂–µ—Ä–µ–ª–æ:</b><br>–•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ</div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); tg.setHeaderColor('#060606'); tg.setBackgroundColor('#060606');

    const startParam = tg.initDataUnsafe?.start_param || '';
    const isAdmin = startParam === 'godmode_valky';

    const BIN_ID = '699b325fd0ea881f40cf7aaf';
    const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwBt7Fi0bp113WAqSQUZQG84aXOYR33Xv-lDGGfIFvN4s6dfYbDpj1zxmuiE05Jltqgag/exec';

    const houseSvg = `<svg class="icon-house" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>`;
    const iconBan = `<svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line></svg>`;
    const iconLightningSVG = `<svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>`;
    const iconBulb = `<svg class="interval-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1.2 1.5-2.5 1.5-4a6 6 0 0 0-6-6 6 6 0 0 0-6 6c0 1.4.5 2.7 1.5 4 .7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`;
    const iconZapOff = `<svg class="interval-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="2" y1="2" x2="22" y2="22"></line><path d="M8.5 8.5L3 14h9l-1 8 5.5-5.5"></path><path d="M16 10h5l-1.5 1.5"></path><path d="M12.4 6.6L13 2l-2.6 2.6"></path></svg>`;
    const iconWarning = `<svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M12 2L1 21h22L12 2zm0 3.5L20.5 19h-17L12 5.5zM11 10v4h2v-4h-2zm0 6v2h2v-2h-2z"/></svg>`;
    const statusIconOn = `<svg viewBox="0 0 24 24" width="16" height="16" fill="var(--c-yellow)"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>`;
    const statusIconOff = `<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="var(--c-red)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="2" y1="2" x2="22" y2="22"></line><path d="M8.5 8.5L3 14h9l-1 8 5.5-5.5"></path><path d="M16 10h5l-1.5 1.5"></path><path d="M12.4 6.6L13 2l-2.6 2.6"></path></svg>`;

    let dbDays = {};
    let globalAnnouncement = null;
    let activeDates = []; 
    let initialScrollDone = false;

    function timeToMins(t) {
        if (!t) return null;
        let [h, m] = t.split(':').map(Number);
        return h * 60 + m;
    }

    function minsToStr(mins) {
        if (mins === 1440) return "00:00";
        let h = Math.floor(mins / 60).toString().padStart(2, '0');
        let m = (mins % 60).toString().padStart(2, '0');
        return `${h}:${m}`;
    }

    function openEditModal(startStr, endStr) {
        document.getElementById('editStart').value = startStr;
        document.getElementById('editEnd').value = (endStr === '00:00' || endStr === '24:00') ? '23:59' : endStr;
        document.getElementById('editModal').style.display = 'flex';
    }

    async function sendCustomEdit(type) {
        let s = document.getElementById('editStart').value;
        let e = document.getElementById('editEnd').value;
        if (!s || !e) return alert('–í–∫–∞–∂–∏ –æ–±–∏–¥–≤–∞ –∑–Ω–∞—á–µ–Ω–Ω—è —á–∞—Å—É');
                if (e === '23:59') e = '24:00';

        document.getElementById('editModal').style.display = 'none';
        document.getElementById('app').style.display = 'none';
        document.getElementById('loader').style.display = 'block';
        document.getElementById('loader').textContent = '–ó–∞–ø–∏—Å—É—î–º–æ –∑–º—ñ–Ω–∏... ‚ö°';

        const payload = {
            source: 'miniapp', secret: tg.initDataUnsafe?.start_param || '', userId: tg.initDataUnsafe?.user?.id || 0,
            date: activeDates[0], action: 'add_override', type: type, interval: { start: s, end: e }
        };
        try {
            await fetch(GAS_WEB_APP_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload) });
            setTimeout(fetchData, 1500);
        } catch (err) { alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message); fetchData(); }
    }

    async function sendResetDay() {
        if(!confirm('–°—Ç–µ—Ä—Ç–∏ –≤—Å—ñ —Ä—É—á–Ω—ñ –∑–º—ñ–Ω–∏ —ñ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –±–∞–∑–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ?')) return;
        document.getElementById('editModal').style.display = 'none';
        document.getElementById('app').style.display = 'none';
        document.getElementById('loader').style.display = 'block';
        document.getElementById('loader').textContent = '–°–∫–∏–¥–∞—î–º–æ –≥—Ä–∞—Ñ—ñ–∫... üîÑ';
        
        const payload = { source: 'miniapp', secret: tg.initDataUnsafe?.start_param || '', userId: tg.initDataUnsafe?.user?.id || 0, date: activeDates[0], action: 'reset_day' };
        try {
            await fetch(GAS_WEB_APP_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload) });
            setTimeout(fetchData, 1500);
        } catch (err) { alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message); fetchData(); }
    }

    async function sendCleanOld() {
        if (!confirm('–¢–æ—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ –¥–Ω—ñ –∑ –±–∞–∑–∏?')) return;
        document.getElementById('app').style.display = 'none';
        document.getElementById('loader').style.display = 'block';
        document.getElementById('loader').textContent = '–ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Å–º—ñ—Ç—Ç—è... üßπ';
        
        const payload = { source: 'miniapp', secret: tg.initDataUnsafe?.start_param || '', userId: tg.initDataUnsafe?.user?.id || 0, action: 'clean_old', activeDates: activeDates };
        try {
            await fetch(GAS_WEB_APP_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload) });
            setTimeout(fetchData, 1500);
        } catch (e) { alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + e.message); fetchData(); }
    }

    async function sendPublishDraft() {
        if (!confirm('–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è –≤—Å—ñ—Ö?')) return;
        document.getElementById('app').style.display = 'none';
        document.getElementById('loader').style.display = 'block';
        document.getElementById('loader').textContent = '–ü—É–±–ª—ñ–∫—É—î–º–æ... üöÄ';
        const payload = { source: 'miniapp', secret: tg.initDataUnsafe?.start_param || '', userId: tg.initDataUnsafe?.user?.id || 0, action: 'publish_draft' };
        try { await fetch(GAS_WEB_APP_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload) }); setTimeout(fetchData, 1500); } catch (err) { alert('–ü–æ–º–∏–ª–∫–∞: ' + err.message); fetchData(); }
    }

    async function sendAnnouncement() {
        let text = prompt('–í–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç (–∞–±–æ –∑–∞–ª–∏—à–∞—î–º–æ –ø—É—Å—Ç–∏–º, —â–æ–± –≤–∏–¥–∞–ª–∏—Ç–∏):');
        if (text === null) return;
        document.getElementById('app').style.display = 'none';
        document.getElementById('loader').style.display = 'block';
        document.getElementById('loader').textContent = '–û–Ω–æ–≤–ª—é—î–º–æ ... ü§´';
        const payload = { source: 'miniapp', secret: tg.initDataUnsafe?.start_param || '', userId: tg.initDataUnsafe?.user?.id || 0, action: text ? 'set_announcement' : 'clear_announcement', text: text };
        try { await fetch(GAS_WEB_APP_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload) }); setTimeout(fetchData, 1500); } catch (err) { alert('–ü–æ–º–∏–ª–∫–∞: ' + err.message); fetchData(); }
    }

    async function fetchData() {
        try {
            const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest?nocache=${new Date().getTime()}`, { cache: 'no-store', headers: { 'Pragma': 'no-cache' } });
            const result = await response.json();
            const data = result.record;

            const months = ["–°–Ü–ß–ù–Ø", "–õ–Æ–¢–û–ì–û", "–ë–ï–†–ï–ó–ù–Ø", "–ö–í–Ü–¢–ù–Ø", "–¢–†–ê–í–ù–Ø", "–ß–ï–†–í–ù–Ø", "–õ–ò–ü–ù–Ø", "–°–ï–†–ü–ù–Ø", "–í–ï–†–ï–°–ù–Ø", "–ñ–û–í–¢–ù–Ø", "–õ–ò–°–¢–û–ü–ê–î–ê", "–ì–†–£–î–ù–Ø"];
            const today = new Date();
            const todayStr = `${today.getDate()} ${months[today.getMonth()]}`;
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = `${tomorrow.getDate()} ${months[tomorrow.getMonth()]}`;

            dbDays = {};
            activeDates = [];
            globalAnnouncement = data.announcement || null;

            if (data.days) {
                if (data.days[todayStr]) { dbDays[todayStr] = data.days[todayStr]; activeDates.push(todayStr); }
                if (data.days[tomorrowStr]) { dbDays[tomorrowStr] = data.days[tomorrowStr]; activeDates.push(tomorrowStr); }
            } else if (data.intervals) { 
                const fallbackDate = data.date || "–°–¨–û–ì–û–î–ù–Ü";
                dbDays = { [fallbackDate]: { intervals: data.intervals, overrides: data.overrides || [] } };
                activeDates.push(fallbackDate);
            }

            document.getElementById('loader').style.display = 'none';
            document.getElementById('app').style.display = 'block';

            if (globalAnnouncement) {
                document.getElementById('toastText').textContent = globalAnnouncement;
                document.getElementById('toastInside').style.display = 'flex';
                setTimeout(() => { document.getElementById('toastInside').style.display = 'none'; }, 6000);
            }


            startTimerAndRender();
        } catch (error) {
            document.getElementById('loader').textContent = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π –ø—ñ–∑–Ω—ñ—à–µ.";
        }
    }

        function buildDisplayIntervals(rawIntervals, overrides) {
        if (!rawIntervals || rawIntervals.length === 0) return [];
        let minuteMap = new Array(1440).fill(null);

        rawIntervals.forEach(int => {
            let type = int.type || int.planType || 'off'; 
            for (let i = int.startMin; i < int.endMin; i++) {
                minuteMap[i] = { state: type, isOverride: false, info: null };
            }
        });


        if (overrides && overrides.length > 0) {
            overrides.forEach(ov => {
                for (let i = ov.startMin; i < ov.endMin; i++) {
                    let st = (ov.type === 'emergency') ? 'emergency' : 'on';
                    let infoText = (ov.type === 'emergency') 
                        ? `‚ö†Ô∏è –ê–≤–∞—Ä—ñ–π–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑ ${ov.startStr} –¥–æ ${ov.endStr}` 
                        : `üí° –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ –∑ ${ov.startStr} –¥–æ ${ov.endStr}`;
                    minuteMap[i] = { state: st, isOverride: true, info: infoText };
                }
            });
        }

                let merged = [];
        let current = null;

        for (let i = 0; i <= 1440; i++) {
            let m = minuteMap[i];
            
            // –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø—É—Å—Ç–∏—Ö —Ö–≤–∏–ª–∏–Ω (—è–∫—â–æ —ñ–Ω—Ñ–∞ –≤—ñ–¥—Å—É—Ç–Ω—è, –≤–≤–∞–∂–∞—î–º–æ, —â–æ —Å–≤—ñ—Ç–ª–æ —î)
            if (i < 1440 && !m) {
                m = { state: 'on', isOverride: false, info: null };
            }

            if (i === 0) {
                current = { startMin: i, startStr: minsToStr(i), state: m.state, isOverride: m.isOverride, info: m.info };
                continue;
            }

            let isDifferent = i < 1440 && m && (m.state !== current.state || m.isOverride !== current.isOverride || m.info !== current.info);

            if (i === 1440 || isDifferent) {
                current.endMin = i;
                current.displayEndStr = minsToStr(i);
                merged.push(current);

                if (i < 1440) {
                    current = { startMin: i, startStr: minsToStr(i), state: m.state, isOverride: m.isOverride, info: m.info };
                }
            }
        }


        return merged.map(m => {
            return {
                startMin: m.startMin, endMin: m.endMin,
                startStr: m.startStr, displayEndStr: m.displayEndStr,
                type: (m.state === 'emergency' ? 'on' : m.state),
                isEmergencyBlock: (m.state === 'emergency'),
                isModified: m.isOverride,
                info: m.info
            };
        });
    }

    function generateDayHtml(rawIntervals, overrides, currentMins, isToday) { 
        const displayIntervals = buildDisplayIntervals(rawIntervals || [], overrides);
        let html = '';

        displayIntervals.forEach((int, i) => {
            const isEmergency = int.isEmergencyBlock;
            const isVisuallyOn = int.type === 'on' && !isEmergency;
            const stateClass = isEmergency ? 'emergency' : (isVisuallyOn ? 'on' : 'off');

            const isActive = isToday && (currentMins >= int.startMin && currentMins < int.endMin);
            const isPast = isToday && (currentMins >= int.endMin);
            const isFuture = !isToday || (currentMins < int.startMin);

            let classes = `tl-item ${stateClass}`;
            if (isActive) { classes += ' active-now'; if (isEmergency) classes += ' emergency-active'; }
            if (isPast) classes += ' past-interval';

            let badgeHtml = '';
            let intervalTextStyle = '';

                        if (isEmergency) {
                badgeHtml = `<div class="badge-row"><div class="badge emergency">${iconWarning} –ê–í–ê–†–Ü–ô–ù–ï</div></div>`;
            } else if (int.type === 'off') {
                if (int.isModified) {
                    let statusText = isPast ? "–í–Ü–î–ö–õ–Æ–ß–ê–õ–ò" : (isActive ? "–ù–ï–ú–ê –°–í–Ü–¢–õ–ê" : "–°–ö–ê–°–û–í–ê–ù–û");
                    badgeHtml = `<div class="badge-row"><div class="badge on" style="text-decoration: line-through; opacity: 0.5;">${iconLightningSVG} –°–í–Ü–¢–õ–û</div><span class="badge-modifier emergency">${statusText}</span></div>`;
                    intervalTextStyle = `color: rgba(217, 70, 59, 0.7); text-decoration: line-through;`;
                } else {
                    badgeHtml = `<div class="badge-row"><div class="badge off"><span style="color:var(--c-red); display:flex;">${iconBan}</span> –í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø</div></div>`;
                }
            } else if (int.type === 'on') {
                if (int.isModified) {
                    let statusText = isPast ? `${iconLightningSVG} –°–í–Ü–¢–õ–û –ë–£–õ–û` : (isActive ? `${iconLightningSVG} –Ñ –°–í–Ü–¢–õ–û` : "–°–ö–ê–°–û–í–ê–ù–û");
                    badgeHtml = `<div class="badge-row"><div class="badge off" style="text-decoration: line-through; opacity: 0.5;">${iconBan} –í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø</div><span class="badge-modifier rescued" style="display: flex; align-items: center; gap: 4px;">${statusText}</span></div>`;
                    intervalTextStyle = `color: rgba(251, 191, 36, 0.7); text-decoration: line-through;`;
                } else {
                    let lightText = isFuture ? "–°–í–Ü–¢–õ–û" : "–°–í–Ü–¢–õ–û –Ñ";
                    badgeHtml = `<div class="badge-row"><div class="badge on">${iconLightningSVG} ${lightText}</div></div>`;
                }
            }


            const intIcon = isEmergency ? iconZapOff : (isVisuallyOn ? iconBulb : iconZapOff);

            let dotsHtml = '';
            if (i < displayIntervals.length - 1) {
                let durationMins = int.endMin - int.startMin;
                let numDots = Math.max(1, Math.floor(durationMins / 60));
                for (let d = 0; d < numDots; d++) dotsHtml += `<div class="tl-dot-micro ${stateClass}"></div>`;
            }

            const timeColClass = isEmergency ? 'emergency' : stateClass;
            let nowIndicator = isActive ? `<div class="now-badge">–ó–ê–†–ê–ó</div>` : '';

            let adminControls = '';
            if (typeof isAdmin !== 'undefined' && isAdmin) {
                adminControls = `
                <div style="margin-top: 12px; display: flex; gap: 8px; z-index: 10; position: relative;">
                    <button onclick="openEditModal('${int.startStr}', '${int.displayEndStr}')" 
                            style="background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 800; text-transform: uppercase; cursor: pointer;">
                        ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                    </button>
                </div>`;
            }

                        let infoIconHtml = int.info ? 
            `<span onclick="alert('${int.info}')" style="margin-left: 8px; cursor: pointer; display: inline-flex; align-items: center; color: #888; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
            </span>` : '';


            html += `
            <div class="${classes}">
                <div class="tl-head">
                    <div class="time-col ${timeColClass}">${int.startStr}</div>
                    <div class="icon-node"><div class="icon-circle">${houseSvg}</div></div>
                    <div class="badge-col">${badgeHtml}</div>
                    ${nowIndicator}
                </div>
                <div class="tl-body">
                    <div class="time-col"></div>
                    <div class="line-node">${dotsHtml}</div>
                    <div class="interval-col" style="flex-direction: column; align-items: flex-start; justify-content: center;">
                        <div class="interval ${stateClass}">
                            <div class="interval-icon">${intIcon}</div>
                            <span class="interval-text" style="${intervalTextStyle}">${int.startStr} ‚Äì ${int.displayEndStr}</span>
                            ${infoIconHtml}
                        </div>
                        ${adminControls}
                    </div>
                </div>
            </div>`;
        });
        return html;
    }

        function renderAllDays(currentMins) {
        const container = document.getElementById('timelineContainer');
        let fullHtml = '';

        if (typeof isAdmin !== 'undefined' && isAdmin) {
            fullHtml += `
            <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: center;">
                <button onclick="sendPublishDraft()" style="background: rgba(34, 197, 94, 0.15); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.3); padding: 10px 15px; border-radius: 10px; font-weight: 800; font-size: 12px; text-transform: uppercase; cursor: pointer;">
                    üöÄ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏
                </button>
                <button onclick="sendAnnouncement()" style="background: rgba(168, 85, 247, 0.15); color: #a855f7; border: 1px solid rgba(168, 85, 247, 0.3); padding: 10px 15px; border-radius: 10px; font-weight: 800; font-size: 12px; text-transform: uppercase; cursor: pointer;">
                    ü§´ –Ü–Ω—Å–∞–π–¥
                </button>
            </div>`;
        }

        if (activeDates.length === 0) {
            fullHtml += `<div class="waiting-block">‚è≥ –û—á—ñ–∫—É—î–º–æ –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥ –û–±–ª–µ–Ω–µ—Ä–≥–æ</div>`;
            container.innerHTML = fullHtml;
            return;
        }

        activeDates.forEach((dateStr, index) => {
            const dayData = dbDays[dateStr];
            const isToday = (index === 0);

            // –†–∞—Ö—É—î–º–æ —Å—É–º–∞—Ä–Ω–∏–π —á–∞—Å –±–µ–∑ —Å–≤—ñ—Ç–ª–∞
            const displayIntsCount = buildDisplayIntervals(dayData.intervals || [], dayData.overrides || []);
            let offMins = 0;
 
            displayIntsCount.forEach(int => {
                let realState = 'on';
                if (int.isEmergencyBlock) realState = 'off';
                else if (int.type === 'off' && !int.isModified) realState = 'off';
                else if (int.type === 'on' && int.isModified) 
                    realState = 'off'; 
                
                if (realState === 'off') offMins += (int.endMin - int.startMin);
            });
            let hOff = Math.floor(offMins / 60);
            let mOff = offMins % 60;
    
            let totalOffText = `${hOff} –≥–æ–¥ ${mOff > 0 ? mOff + ' —Ö–≤' : ''}`;

            let globalEditBtn = '';
            if (typeof isAdmin !== 'undefined' && isAdmin) {
                globalEditBtn = `
                <div style="margin-top: 10px; display: flex; justify-content: center;">
                    <button onclick="openEditModal('00:00', '00:00')" style="background: rgba(255,255,255,0.05); color: #fff; border: 1px dashed rgba(255,255,255,0.3); padding: 8px 15px; border-radius: 10px; font-size: 12px; font-weight: 800; text-transform: uppercase; cursor: pointer;">
                        ‚úèÔ∏è –î–æ–¥–∞—Ç–∏ –∑–º—ñ–Ω—É –≤—Ä—É—á–Ω—É
                    </button>
                </div>`;
            }

            if (!isToday) {
                fullHtml += `
                    <div class="section-divider" style="margin: 40px 0 20px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <div style="height:1px; background:rgba(255,255,255,0.1); flex:1;"></div>
                        <div style="font-size: 11px; font-weight: 900; color: #888; text-transform: uppercase; letter-spacing: 1px;">–ì–†–ê–§–Ü–ö –ù–ê ${dateStr}</div>
                        <div style="height:1px; background:rgba(255,255,255,0.1); flex:1;"></div>
                    </div>`;
            }

            fullHtml += `
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="background: rgba(217, 70, 59, 0.1); border: 1px solid rgba(217, 70, 59, 0.2); color: var(--c-red); padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: 800;">
                        –í—Å—å–æ–≥–æ –±–µ–∑ —Å–≤—ñ—Ç–ª–∞: ${totalOffText}
                    </span>
                    ${globalEditBtn}
                </div>`;

            fullHtml += generateDayHtml(dayData.intervals, dayData.overrides || [], currentMins, isToday);
        });

        if (activeDates.length === 1) {
            fullHtml += `
                <div class="fade-dots" style="margin-top:20px;">
                    <div class="fade-dot"></div><div class="fade-dot"></div><div class="fade-dot"></div>
                </div>
                <div class="waiting-block" style="padding-top:10px;">
                    ‚ö° –û—á—ñ–∫—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ –∑–∞–≤—Ç—Ä–∞<span class="spinner-dots"></span>
                </div>`;
        }

        if (typeof isAdmin !== 'undefined' && isAdmin) {
            fullHtml += `
            <div style="text-align: center; margin-top: 30px; margin-bottom: 10px;">
                <button onclick="sendCleanOld()" style="background: rgba(217, 70, 59, 0.15); color: var(--c-red); border: 1px solid rgba(217, 70, 59, 0.3); padding: 12px 20px; border-radius: 12px; font-weight: 800; font-size: 13px; text-transform: uppercase; cursor: pointer;">
                    üßπ –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ä—ñ –¥–Ω—ñ
                </button>
            </div>`;
        }

        container.innerHTML = fullHtml;
        if (!initialScrollDone) {
            setTimeout(() => {
                const activeEl = document.querySelector('.active-now');
                if (activeEl) activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                initialScrollDone = true;
            }, 300);
        }
    }


    function startTimerAndRender() {
        let lastRenderedIntervalIndex = -1;
        setInterval(() => {
            const now = new Date();
            const currentMins = now.getHours() * 60 + now.getMinutes();
            const currentSecs = now.getSeconds();

            const dateDisplay = document.getElementById('dateDisplay');
            const timerDisplay = document.getElementById('timerDisplay');
            const timerLabel = document.getElementById('timerLabel');
            const timerStatus = document.getElementById('timerStatus');

            if (activeDates.length === 0) {
                dateDisplay.textContent = "–û–ß–Ü–ö–£–Ñ–ú–û";
                timerDisplay.textContent = "--:--:--";
                timerLabel.textContent = "–û—á—ñ–∫—É–≤–∞–Ω–Ω—è";
                timerStatus.innerHTML = `${iconBulb} –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö`;
                timerStatus.style.color = '#888';
                return;
            }

            dateDisplay.textContent = activeDates[0];

            let combinedIntervals = [];
            activeDates.forEach((dateStr, dayIndex) => {
                const dayData = dbDays[dateStr];
                const offset = dayIndex * 1440;
                
                
                const displayInts = buildDisplayIntervals(dayData.intervals || [], dayData.overrides || []);
                
                displayInts.forEach(int => {
                                    let realState = 'on';
                if (int.isEmergencyBlock || int.type === 'off') {
                    realState = 'off';
                }


                    combinedIntervals.push({
                        startMinAbs: int.startMin + offset,
                        endMinAbs: int.endMin + offset,
                        realState: realState
                    });
                });
            });

            let currentIntIndex = combinedIntervals.findIndex(int => currentMins >= int.startMinAbs && currentMins < int.endMinAbs);
            let currentState = 'on';
            let nextEventMinsAbs = null;

            if (currentIntIndex !== -1) {
                currentState = combinedIntervals[currentIntIndex].realState;
                for (let i = currentIntIndex + 1; i < combinedIntervals.length; i++) {
                    if (combinedIntervals[i].realState !== currentState) {
                        nextEventMinsAbs = combinedIntervals[i].startMinAbs;
                        break;
                    }
                }
            }

            if (currentIntIndex !== lastRenderedIntervalIndex || lastRenderedIntervalIndex === -1) {
                renderAllDays(currentMins);
                lastRenderedIntervalIndex = currentIntIndex;
            }

            if (currentState === 'off') {
                timerStatus.innerHTML = `${statusIconOff} –°–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞—î`;
                timerStatus.style.color = 'var(--c-red)';
                timerDisplay.className = 'timer-time off';
                timerLabel.textContent = '–î–æ –≤–∫–ª—é—á–µ–Ω–Ω—è:';
                                
                document.getElementById('sonyaMascot').style.display = 'block';

            } else {
                timerStatus.innerHTML = `${statusIconOn} –°–≤—ñ—Ç–ª–æ —î`;
                timerStatus.style.color = 'var(--c-yellow)';
                timerDisplay.className = 'timer-time on';
                timerLabel.textContent = '–î–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:';
                                document.getElementById('sonyaMascot').style.display = 'none';

            }

            if (nextEventMinsAbs !== null) {
                let diffMins = nextEventMinsAbs - currentMins - 1;
                let diffSecs = 60 - currentSecs;
                if (diffSecs === 60) { diffSecs = 0; diffMins++; }

                let h = Math.floor(diffMins / 60).toString().padStart(2, '0');
                let m = (diffMins % 60).toString().padStart(2, '0');
                let s = diffSecs.toString().padStart(2, '0');
                timerDisplay.textContent = `${h}:${m}:${s}`;
            } else {
                timerDisplay.textContent = "--:--:--";
                if (activeDates.length === 1) timerLabel.textContent = "–û–Ω–æ–≤–ª—é—î–º–æ";
                else timerLabel.textContent = "–î–æ –∫—ñ–Ω—Ü—è –¥–æ–±–∏";
            }
        }, 1000);
    }

    fetchData();
</script>

<div id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 9999; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box;">
    <div style="background: #111; border: 1px solid #333; border-radius: 20px; padding: 25px; width: 100%; max-width: 380px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
        <h3 style="margin: 0 0 15px 0; font-weight: 900; font-size: 18px; letter-spacing: 0.5px;">–í–∫–∞–∂–∏ —á–∞—Å (–ì–æ–¥–∏–Ω–∏:–•–≤–∏–ª–∏–Ω–∏)</h3>
        
        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
            <input type="time" id="editStart" style="background: #222; color: #fff; border: 1px solid #444; padding: 10px; border-radius: 8px; font-size: 16px; font-weight: bold; width: 100px; text-align: center;">
            <span style="color: #666; align-self: center; font-weight: bold;">‚Äî</span>
            <input type="time" id="editEnd" style="background: #222; color: #fff; border: 1px solid #444; padding: 10px; border-radius: 8px; font-size: 16px; font-weight: bold; width: 100px; text-align: center;">
        </div>
        
        <button class="f-link" onclick="sendCustomEdit('cancel')" style="width: 100%; justify-content: center; margin-bottom: 10px; background: rgba(251, 191, 36, 0.1); color: var(--c-yellow); border-color: var(--c-yellow); font-size: 14px;">
            üí° –°–≤—ñ—Ç–ª–æ —î (–°–∫–∞—Å—É–≤–∞—Ç–∏)
        </button>
        <button class="f-link" onclick="sendCustomEdit('emergency')" style="width: 100%; justify-content: center; margin-bottom: 10px; background: rgba(217, 70, 59, 0.1); color: var(--c-red); border-color: var(--c-red); font-size: 14px;">
            ‚ö†Ô∏è –ê–≤–∞—Ä—ñ–π–Ω–µ (–ù–µ–º–∞ —Å–≤—ñ—Ç–ª–∞)
        </button>
        <button class="f-link" onclick="sendResetDay()" style="width: 100%; justify-content: center; margin-bottom: 20px; background: rgba(255, 255, 255, 0.05); color: #aaa; border: 1px dashed #555; font-size: 14px;">
            üîÑ –°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏ –∑–∞ –¥–æ–±—É
        </button>
        
        <div style="color: #666; font-size: 14px; font-weight: 800; text-transform: uppercase; cursor: pointer; letter-spacing: 1px;" onclick="document.getElementById('editModal').style.display='none'">
            –ó–∞–∫—Ä–∏—Ç–∏
        </div>
    </div>
</div>

</body>
</html>
